<!DOCTYPE html>
<html lang="ru" dir="ltr">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Переход к Cash</title>
	<link rel="stylesheet" href="style.css">
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
	<h1>Кредит на карту</h1>

	<section>
		<form id="main">
			<div>
				<input type="text" id="login">
				<label>Ваш логин</label>
			</div>
			<div>
				<input type="text" id="TT">
				<label>Код ТТ (только цифры)</label>
			</div>
		</form>
		<input type="button" value="Скопировать ссылку" id="copy">
		<input type="button" value="Перейти" id="go">
	</section>
	<input id="copyField" type="text">
</body>

<script>
	( function ( ) {
		const 
			go = document.querySelector("#go"),
			login = document.querySelector("#login"),
			tt = document.querySelector("#TT"),
			copyField = document.querySelector("#copyField"),
			copyButton = document.querySelector("#copy")
		;
		
		tt.value = localStorage.getItem("tt") || "";
		login.value = localStorage.getItem("login") || "";

		go.addEventListener("click", openLink.bind(null, login, tt), false);
		copyButton.addEventListener("click", copyLink.bind(null, login, tt), false);

		function openLink(login, tt) {
			saveToLS(login, tt);
			document.location.href = generateLink(login, tt);
		}

		function copyLink(login, tt) {
			copyField.value = generateLink(login, tt);
			copyField.select( );
			document.execCommand("copy");
			saveToLS(login, tt);
			alert(`Скопировано: ${copyField.value}`);
		}

		function generateLink(login, tt) {
			return `https://cash.otpbank.ru/?utm_source=MMO&utm_medium=${tt.value}&utm_campaign=${login.value}`;
		}

		function saveToLS(login, tt) {
			localStorage.setItem("tt", tt.value);
			localStorage.setItem("login", login.value);
		}
	} ) ( )
</script>

</html>