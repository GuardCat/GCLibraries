<!html>
<head>
	<meta charset="utf-8">
</head>
<body>
	<h1>Конвертер CSV to JSON</h1>
	<input type="file">
	
	<hr style = "margin-bottom: 20px; margin-top: 20px; height: 0.5 px">
	
	<input type="button" value = "Save as..." disabled>

	<script src="saveFile.js"></script>
	<script src="CSVToJSON.js"></script>
	<script src="../compressJSON.js"></script>

	<script>
		const 
			reader = new FileReader( ),
			button = document.querySelector("input[type='button']"),
			fileInput = document.querySelector("input[type='file']")
		;
		
		let json, csv;
		
		fileInput.addEventListener( "change",
			( ) => {
				const file = fileInput.files[0];
				reader.readAsText(file)

				reader.onload = ( ) => {
					csv = reader.result;
					json = CSVToJSON(csv);
					button.removeAttribute("disabled");	
					console.info("Loaded");
				}

			}, false );
					
		button.addEventListener( "click", 
			( ) => saveFile( JSON.stringify(json), {type: "text/json", charset: "utf-8", name: prompt("Введите имя файла: ")} ), false);
		
		//saveFile(a, {type: "text/json", charset: "utf-8", name: "pretest.json"});

		//window.open(`data:text/json;charset=utf-8,${encodeURI(a)}`)
		//alert(1)
	</script>
</body>
</html>